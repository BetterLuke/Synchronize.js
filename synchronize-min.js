/**
 * Synchronize.js
 * Version 1.0.0
 *
 * Copyright 2013 Denis Meyer
 */
!function(e){function n(e,n,t){return!isNaN(e)&&!isNaN(n)&&!isNaN(t)&&t>=n?e>=n&&t>=e:!1}function t(e){return videojs(e).play()}function r(e,n){return videojs(e).volume(n)}function o(e){return videojs(e).pause()}function i(e){return videojs(e).paused()}function s(e){return videojs(e).duration()}function u(e){return videojs(e).currentTime()}function a(e){return e.Q}function f(e,n){return!isNaN(n)&&n>=0&&n<=s(e)?(videojs(e).currentTime(n),!0):(videojs(e).currentTime(s(e)),!1)}function d(){for(var r,o=u(p),i=0;i<N.length;++i)N[i]!=p&&(r=u(N[i]),-1==o||-1==r||n(r,o-P,o)||(e(document).trigger("sjs:synchronizing",[o,N[i]]),f(N[i],o)&&t(N[i])))}function g(){if(j()){var n=videojs(p);n.on("play",function(){e(document).trigger("sjs:masterPlay",[u(p)]),V=!1,B||(B=!0,c());for(var n=0;n<N.length;++n)N[n]!=p&&(videojs(N[n]).on("play",function(){r(a(this),0)}),t(N[n]))}),n.on("pause",function(){e(document).trigger("sjs:masterPause",[u(p)]),V=!R&&Q&&!0,R=R?!R:R;for(var n=0;n<N.length;++n)N[n]!=p&&(o(N[n]),d())}),n.on("ended",function(){e(document).trigger("sjs:masterEnded",[s(p)]),V=!0;for(var n=0;n<N.length;++n)N[n]!=p&&(d(),o(N[n]))}),n.on("timeupdate",function(){e(document).trigger("sjs:masterTimeupdate",[u(p)]),V=!0;var n=Date.now();if(n-A>I||i(p)){A=n;for(var t,s=0;s<N.length;++s)N[s]!=p&&(r(N[s],0),t=i(N[s]),d(),(t||i(p))&&o(N[s]))}})}else for(var f=0;f<N.length;++f)o(N[f])}function c(){y=window.setInterval(function(){for(var n=!0,r=u(p),i=0;i<N.length;++i){var a=videojs(N[i]).buffered(),f=a.length,d=a.start(0),g=a.end(0),c=g-d;if(a&&f>0){var l=s(N[i]),v=r+k;v=v>l?l:v,n=n&&c>=v}else n=!1}if(n)Q&&!V?(Q=!1,t(p),V=!1,e(document).trigger("sjs:bufferedAndAutoplaying",[])):Q&&(Q=!1,e(document).trigger("sjs:bufferedButNotAutoplaying",[]));else{Q=!0,R=!0;for(var i=0;i<N.length;++i)o(N[i]);V=!1,e(document).trigger("sjs:buffering",[])}},E)}function l(n){T=n<N.length?n:0,p=N[T],e(document).trigger("sjs:masterSet",[p])}function v(e,n){videojs(e).on("loadeddata",function(){n()})}function j(){for(var e=0;e<N.length;++e)if(!b[N[e]])return!1;return!0}function m(){o(a(this)),z=!0}function h(){o(a(this)),z=!1}var p,y,N=[],w={},b={},T=0,A=0,I=2e3,P=1,z=!1,B=!1,E=1e3,Q=!1,R=!1,V=!1,k=1.5;e.synchronizeVideos=function(n){T=n;for(var r=!0,o=1;o<arguments.length;++o)r=r&&arguments[o]&&e("#"+arguments[o]).length,r?(N[N.length]=arguments[o],w[N[o-1]]=!1,b[N[o-1]]=!1):e(document).trigger("sjs:invalidId",[arguments[o]]);if(r&&N.length>1)for(var o=0;o<N.length;++o){e(document).trigger("sjs:idRegistered",[N[o]]);var i=n;videojs(N[o]).on("play",m),videojs(N[o]).on("pause",h),videojs(N[o]).ready(function(){var n=a(this);w[n]=!0,v(n,function(){if(b[n]=!0,e(document).trigger("sjs:playerLoaded",[n]),j()){l(i);for(var r=0;r<N.length;++r)videojs(N[r]).off("play",m),videojs(N[r]).off("pause",h);g(),z&&t(p),e(document).trigger("sjs:allPlayersReady",[])}})})}else e(document).trigger("sjs:notEnoughVideos",[]);e(document).on("sjs:cleanBufferChecker",function(){window.clearInterval(y)})}}(jQuery);