/**
 * Synchronize.js
 * Version 1.0.0
 *
 * Copyright 2013 Denis Meyer
 */
!function(n){function e(n,e,r){return!isNaN(n)&&!isNaN(e)&&!isNaN(r)&&r>=e?n>=e&&r>=n:!1}function r(e){return e?o()?videojs(e):n("#"+e):void 0}function t(n){return n?o()?videojs(n):r(n).get(0):void 0}function o(){return!("undefined"==typeof videojs)}function u(n){return o()&&n?n.Q:n}function i(n){return n?(t(n).play(),!0):!1}function f(n){return n?(o()?t(n).volume(0):t(n).muted=!0,void 0):void 0}function a(n){return n?t(n).pause():!1}function s(n){return n?o()?t(n).paused():t(n).paused:!1}function g(n){return n?o()?t(n).duration():t(n).duration:-1}function d(n){return n?o()?t(n).currentTime():t(n).currentTime:-1}function c(n,e){return n&&!isNaN(e)&&e>=0&&e<=g(n)?(o()?t(n).currentTime(e):t(n).currentTime=e,!0):!1}function l(n){return n?o()?t(n).buffered():t(n).buffered:void 0}function v(n,e){var r=g(n);return-1!=r&&!isNaN(e)&&e>=0&&r>=e?c(n,e):(c(n,r),!1)}function m(){for(var r,t=d(P),o=0;o<A.length;++o)A[o]!=P&&(r=d(A[o]),-1==t||-1==r||e(r,t-k,t)||(n(document).trigger("sjs:synchronizing",[t,A[o]]),v(A[o],t)&&i(A[o])))}function h(){if(b()){var e=r(P);e.on("play",function(){n(document).trigger("sjs:masterPlay",[d(P)]),x=!1,D||(D=!0,p());for(var e=0;e<A.length;++e)A[e]!=P&&(r(A[e]).on("play",function(){f(A[e])}),i(A[e]))}),e.on("pause",function(){n(document).trigger("sjs:masterPause",[d(P)]),x=!q&&S&&!0,q=q?!q:q;for(var e=0;e<A.length;++e)A[e]!=P&&(a(A[e]),m())}),e.on("ended",function(){n(document).trigger("sjs:masterEnded",[g(P)]),x=!0;for(var e=0;e<A.length;++e)A[e]!=P&&(m(),a(A[e]))}),e.on("timeupdate",function(){n(document).trigger("sjs:masterTimeupdate",[d(P)]),x=!0;var e=Date.now();if(e-Q>V||s(P)){Q=e;for(var r,t=0;t<A.length;++t)A[t]!=P&&(f(A[t]),r=s(A[t]),m(),(r||s(P))&&a(A[t]))}})}else for(var t=0;t<A.length;++t)a(A[t])}function p(){R=window.setInterval(function(){for(var r=!0,t=(d(P),0);t<A.length;++t){var o=l(A[t]);if(o){var u=g(A[t]),f=d(A[t])+F,s=!1;for(j=0;j<o.length&&!s;++j)f=f>=u?u:f,e(f,o.start(j),o.end(j))&&(s=!0);r=r&&s}}if(r)S&&!x?(S=!1,i(P),x=!1,n(document).trigger("sjs:bufferedAndAutoplaying",[])):S&&(S=!1,n(document).trigger("sjs:bufferedButNotAutoplaying",[]));else{S=!0,q=!0;for(var t=0;t<A.length;++t)a(A[t]);x=!1,n(document).trigger("sjs:buffering",[])}},L)}function y(e){B=e<A.length?e:0,P=A[B],n(document).trigger("sjs:masterSet",[P])}function N(n,e){n&&e&&r(n).on("loadeddata",function(){e()})}function b(){if(o()){for(var n=0;n<A.length;++n)if(!z[A[n]])return!1;return!0}return E==A.length}function w(){for(var n=0;n<A.length;++n)a(A[n]);C=!0}function T(){for(var n=0;n<A.length;++n)a(A[n]);C=!1}var P,R,A=[],I={},z={},B=0,E=0,Q=0,V=2e3,k=1,C=!1,D=!1,L=1e3,S=!1,q=!1,x=!1,F=1.5;n.synchronizeVideos=function(e){B=e;for(var t=!0,f=1;f<arguments.length;++f)t=t&&arguments[f]&&n("#"+arguments[f]).length,t?(A[A.length]=arguments[f],I[A[f-1]]=!1,z[A[f-1]]=!1):n(document).trigger("sjs:invalidId",[arguments[f]]);if(t&&A.length>1)if(o())for(var f=0;f<A.length;++f){n(document).trigger("sjs:idRegistered",[A[f]]);var a=e;r(A[f]).on("play",w),r(A[f]).on("pause",T),r(A[f]).ready(function(){var e=u(this);I[e]=!0,N(e,function(){if(z[e]=!0,n(document).trigger("sjs:playerLoaded",[e]),b()){y(a);for(var t=0;t<A.length;++t)r(A[t]).off("play",w),r(A[t]).off("pause",T);h(),C&&i(P),n(document).trigger("sjs:allPlayersReady",[])}})})}else for(var f=0;f<A.length;++f){n(document).trigger("sjs:idRegistered",[A[f]]);var a=e;r(A[f]).on("play",w),r(A[f]).on("pause",T),r(A[f]).ready(function(){if(++E,E==A.length){y(a);for(var e=0;e<A.length;++e)r(A[e]).off("play",w),r(A[e]).off("pause",T);h(),C&&i(P),n(document).trigger("sjs:allPlayersReady",[])}})}else n(document).trigger("sjs:notEnoughVideos",[]);n(document).on("sjs:cleanBufferChecker",function(){window.clearInterval(R)})}}(jQuery);