/**
 * Synchronize.js
 * Compiled on 21.02.2016
 * Version 1.2.4
 *
 *  Copyright (C) 2013-2016 Denis Meyer, calltopower88@googlemail.com
 * All rights reserved.

 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 * 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.

 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS
 * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
!function(a){function b(a){$&&window.console&&console.log(a)}function c(a,b,c){return!isNaN(a)&&!isNaN(b)&&!isNaN(c)&&c>=b?a>=b&&c>=a:!1}function d(c){return c?f()?videojs(c):a("#"+c):void b("SJS: [getVideoObj] Undefined video element id '"+c+"'")}function e(a){return a?f()?videojs(a):d(a).get(0):void b("SJS: [getVideo] Undefined video element id '"+a+"'")}function f(){return"undefined"!=typeof videojs}function g(a){if(f()&&a){var b=a.id();return""!==b?b:a}return a}function h(a){return ea?(b("SJS: [play] A video is currently buffering"),!1):a?(b("SJS: [play] Playing video element id '"+a+"'"),e(a).play(),!0):(b("SJS: [play] Undefined video element id '"+a+"'"),!1)}function i(a){return a?(b("SJS: [mute] Muting video element id '"+a+"'"),void(f()?e(a).volume(0):e(a).muted=!0)):void b("SJS: [mute] Undefined video element id '"+a+"'")}function j(a,c){return a&&c?(b("SJS: [unmute] Unmuting video element id '"+a+"'"),f()?e(a).volume(c):(e(a).muted=!1,e(a).volume(c)),!0):(b("SJS: [unmute] Undefined video element id '"+a+"'"),!1)}function k(a){return a?(b("SJS: [volume] Getting volume from video element id '"+a+"': "+e(a).volume()),e(a).volume()):(b("SJS: [volume] Undefined video element id '"+a+"'"),-1)}function l(a){return a?(b("SJS: [pause] Pausing video element id '"+a+"'"),e(a).pause()):(b("SJS: [pause] Undefined video element id '"+a+"'"),!1)}function m(a){return a?f()?e(a).paused():e(a).paused:(b("SJS: [isPaused] Undefined video element id '"+a+"'"),!1)}function n(a){return a?f()?e(a).duration():e(a).duration:(b("SJS: [getDuration] Undefined video element id '"+a+"'"),-1)}function o(a){return a?f()?e(a).currentTime():e(a).currentTime:(b("SJS: [getCurrentTime] Undefined video element id '"+a+"'"),-1)}function p(a,c){if(a){var d=n(a);return-1!=d&&!isNaN(c)&&c>=0&&d>=c?(f()?e(a).currentTime(c):e(a).currentTime=c,!0):(b("SJS: [setCurrentTime] Could not set time for video element id '"+a+"'"),p(a,d),!1)}return b("SJS: [setCurrentTime] Undefined video element id '"+a+"'"),!1}function q(a){return a?f()?e(a).playbackRate():e(a).playbackRate:(b("SJS: [getPlaybackRate] Undefined video element id '"+a+"'"),1)}function r(a,c){return a?(f()?e(a).playbackRate(c):e(a).playbackRate=c,!0):(b("SJS: [setPlaybackRate] Undefined video element id '"+a+"'"),!1)}function s(a){return a?f()?e(a).buffered():e(a).buffered:void b("SJS: [getBufferTimeRange] Undefined video element id '"+a+"'")}function t(a){var b=o(I),d=o(a);return-1==b||-1==d||c(d,b-R,b)?0:d-b}function u(){_=[],aa={},ba={},ca=0,I=null,da=0,ea=!1,fa=!1,ga=!1,J=null,ha=!1,ia=!1,ja=!1,ka=null,la=1e4,ma=!1,na=null,oa=[],pa=!1}function v(){if(_.length<=1)return!1;for(var a=k(I),b=0;b<_.length;++b)if(_[b]!==I){d(I).off(),C(b);break}return A(),j(I,a),!0}function w(c){if(b("Unsynchronizing video with id "+c),c===I){var e=d(I);if(e&&(e.off("play"),e.off("pause"),e.off("ratechange"),e.off("ended"),e.off("timeupdate")),!v())return void y()}console.log(_);for(var f=0;f<_.length;++f)if(_[f]===c){_.splice(f,1),a(document).trigger("sjs:idUnregistered",[c]);break}A(),z(),console.log(_)}function x(c){b("Adding video with id "+c+" to synchronization");for(var d=0;d<_.length;++d)if(_[d]===c)return;_.push(c),a(document).trigger("sjs:idRegistered",[c]),z()}function y(){b("Unsynchronizing all videos");var a=d(I);a&&(a.off("play"),a.off("pause"),a.off("ratechange"),a.off("ended"),a.off("timeupdate")),u()}function z(){for(var c=0;c<_.length;++c)if(_[c]!=I){var d=!1,e=t(_[c]);pa?pa&&(Math.abs(e)>Z&&Math.abs(e)>W?d=!0:m(I)||oa[_[c]]||(b("SJS: [synchronize] Playing video element id '"+_[c]+"'"),h(_[c]))):e>X?Math.abs(e)<S?(a(document).trigger("sjs:synchronizing",[o(I),_[c]]),b("SJS: [synchronize] Decreasing playback rate of video element id '"+_[c]+"' from "+q(_[c])+" to "+(q(I)-.5)),r(_[c],q(I)+U)):(a(document).trigger("sjs:synchronizing",[o(I),_[c]]),r(_[c],q(I)),d=!0):Y>e?Math.abs(e)<S?(a(document).trigger("sjs:synchronizing",[o(I),_[c]]),b("SJS: [synchronize] Increasing playback rate of video element id '"+_[c]+"' from "+q(_[c])+" to "+(q(I)-.5)),r(_[c],q(I)+T)):(a(document).trigger("sjs:synchronizing",[o(I),_[c]]),r(_[c],q(I)),d=!0):m(I)||oa[_[c]]||(r(_[c],q(I)),b("SJS: [synchronize] Playing video element id '"+_[c]+"'"),h(_[c])),d&&(a(document).trigger("sjs:synchronizing",[o(I),_[c]]),b("SJS: [synchronize] Seeking video element id '"+_[c]+"': "+(o(I)+V)),p(_[c],o(I)+V)&&(h(_[c]),m(I)||oa[_[c]]?(b("SJS: [synchronize] Pausing video element id '"+_[c]+"' after seeking"),l(_[c])):(b("SJS: [synchronize] Playing video element id '"+_[c]+"' after seeking"),h(_[c]))))}}function A(){if(E()){var c=d(I);pa=0!==a("#"+I+"_flash_api").length,c.on("play",function(){b("SJS: Master received 'play' event"),a(document).trigger("sjs:masterPlay",[o(I)]),ja=!1,!ga&&K&&(ga=!0,B());for(var c=0;c<_.length;++c)_[c]!=I&&(h(_[c]),i(_[c]))}),c.on("pause",function(){b("SJS: Master received 'pause' event"),a(document).trigger("sjs:masterPause",[o(I)]),ja=!ia&&ha,ia=ia?!ia:ia;for(var c=0;c<_.length;++c)_[c]!=I&&(l(_[c]),z())}),c.on("ratechange",function(){b("SJS: Master received 'ratechange' event"),a(document).trigger("sjs:masterPlaybackRateChanged",[q(I)]);for(var c=0;c<_.length;++c)_[c]!=I&&r(_[c],q(I))}),c.on("ended",function(){b("SJS: Master received 'ended' event"),a(document).trigger("sjs:masterEnded",[n(I)]),ja=!0;for(var c=0;c<_.length;++c)_[c]!=I&&(z(),l(_[c]))}),c.on("timeupdate",function(){a(document).trigger("sjs:masterTimeupdate",[o(I)]),ja=!0;var b=Date.now();if(b-P>Q||m(I)){P=b;for(var c,d=0;d<_.length;++d)_[d]!=I&&(i(_[d]),c=m(_[d]),z())}})}else for(var e=0;e<_.length;++e)l(_[e])}function B(){J=window.setInterval(function(){var b,d=!0;for(b=0;b<_.length;++b){var e=s(_[b]);if(e){for(var f=n(_[b]),g=o(_[b])+N,i=!1,j=0;j<e.length&&!i;++j)g=g>=f?f:g,c(g,e.start(j),e.end(j))&&(i=!0);d=d&&i,ea=!d}}if(d)ha&&!ja?(ha=!1,h(I),ja=!1,a(document).trigger("sjs:bufferedAndAutoplaying",[])):ha&&(ha=!1,a(document).trigger("sjs:bufferedButNotAutoplaying",[]));else{for(ha=!0,ia=!0,b=0;b<_.length;++b)l(_[b]);ja=!1,a(document).trigger("sjs:buffering",[])}},L)}function C(b){ca=b<_.length?b:0,I=_[ca],a(document).trigger("sjs:masterSet",[I])}function D(a,c){""!==a?d(a).on("loadeddata",function(){ma=!0,c&&c()}):b("SJS: [doWhenDataLoaded] Undefined video element id '"+a+"'")}function E(){if(f()){for(var a=0;a<_.length;++a)if(!ba[_[a]])return!1;return!0}return da==_.length}function F(){for(var a=0;a<_.length;++a)l(_[a]);fa=!0}function G(){for(var a=0;a<_.length;++a)l(_[a]);fa=!1}function H(){null!==ka&&(window.clearInterval(ka),ka=null)}var I,J,K=!0,L=1e3,M=5e3,N=2,O=!0,P=0,Q=1e3,R=1,S=4,T=.5,U=-.5,V=.25,W=V+.05,X=.05,Y=-.05,Z=.05,$=!1,_=[],aa={},ba={},ca=0,da=0,ea=!1,fa=!1,ga=!1,ha=!1,ia=!1,ja=!1,ka=null,la=1e4,ma=!1,na=null,oa=[],pa=!1;a.synchronizeVideos=function(c,e){var i,j=!0;if(2==arguments.length){var k=a('video[mediagroup="'+e+'"]');for(i=0;i<k.length;++i){var m=_.length;_[m]=k[i].getAttribute("id");var n="_html5_api";_[m]=f()&&-1!=_[m].indexOf(n)?_[m].substr(0,_[m].length-n.length):_[m],aa[_[i-1]]=!1,ba[_[i-1]]=!1}}else for(ca=c,i=1;i<arguments.length;++i)j=j&&arguments[i]&&a("#"+arguments[i]).length,j?(_[_.length]=arguments[i],aa[_[i-1]]=!1,ba[_[i-1]]=!1):a(document).trigger("sjs:invalidId",[arguments[i]]);if(j&&_.length>1){var o;if(f())for(i=0;i<_.length;++i)a(document).trigger("sjs:idRegistered",[_[i]]),o=c,d(_[i]).on("play",F),d(_[i]).on("pause",G),d(_[i]).ready(function(){var b=g(this);aa[b]=!0,D(b,function(){if(ba[b]=!0,a(document).trigger("sjs:playerLoaded",[b]),E()){C(o);for(var c=0;c<_.length;++c)d(_[c]).off("play",F),d(_[c]).off("pause",G);A(),fa&&h(I),a(document).trigger("sjs:allPlayersReady",[])}}),na=window.setInterval(function(){if(ma)window.clearInterval(na),na=null;else for(var a=0;a<_.length;++a)d(_[a]).trigger("loadeddata")},M)});else for(i=0;i<_.length;++i)a(document).trigger("sjs:idRegistered",[_[i]]),o=c,d(_[i]).on("play",F),d(_[i]).on("pause",G),d(_[i]).ready(function(){if(++da,E()){C(o);for(var b=0;b<_.length;++b)d(_[b]).off("play",F),d(_[b]).off("pause",G);A(),fa&&h(I),a(document).trigger("sjs:allPlayersReady",[])}})}else b("SJS: Not enough videos"),a(document).trigger("sjs:notEnoughVideos",[]);O&&(a(document).on("sjs:buffering",function(){b("SJS: Received 'sjs:buffering' event"),ka=setInterval(function(){E()&&!ja&&h(I)},la)}),a(document).on("sjs:bufferedAndAutoplaying",function(){b("SJS: Received 'sjs:bufferedAndAutoplaying' event"),H()}),a(document).on("sjs:bufferedButNotAutoplaying",function(){b("SJS: Received 'sjs:bufferedButNotAutoplaying' event"),H()})),a(document).on("sjs:play",function(){b("SJS: Received 'sjs:play' event"),E()&&h(I)}),a(document).on("sjs:pause",function(){b("SJS: Received 'sjs:pause' event"),E()&&l(I)}),a(document).on("sjs:setCurrentTime",function(a,c){b("SJS: Received 'sjs:setCurrentTime' event"),E()&&p(I,c)}),a(document).on("sjs:synchronize",function(){b("SJS: Received 'sjs:synchronize' event"),E()&&z()}),a(document).on("sjs:addToSynch",function(a,c){b("SJS: Received 'sjs:addToSynch' event"),c&&x(c)}),a(document).on("sjs:removeFromSynch",function(a,c){b("SJS: Received 'sjs:removeFromSynch' event"),c&&w(c)}),a(document).on("sjs:unsynchronize",function(){b("SJS: Received 'sjs:unsynchronize' event"),y()}),a(document).on("sjs:startBufferChecker",function(){b("SJS: Received 'sjs:startBufferChecker' event"),ga||(window.clearInterval(J),ga=!0,B())}),a(document).on("sjs:stopBufferChecker",function(){b("SJS: Received 'sjs:stopBufferChecker' event"),window.clearInterval(J),ga=!1,ea=!1})},a(document).on("sjs:debug",function(a,c){$=c,b("SJS: Received 'sjs:debug' event")})}(jQuery);