/**
 * Synchronize.js
 * Version 1.1.1
 *
 * Copyright 2013-2014 Denis Meyer
 */
(function(e){function S(e,t,n){if(!isNaN(e)&&!isNaN(t)&&!isNaN(n)&&t<=n){return e>=t&&e<=n}else{return false}}function x(t){if(t){if(!N()){return e("#"+t)}else{return videojs(t)}}else{return undefined}}function T(e){if(e){if(!N()){return x(e).get(0)}else{return videojs(e)}}else{return undefined}}function N(){return!(typeof videojs==="undefined")}function C(e){if(N()&&e){return e.Q}else{return e}}function k(e){if(e){T(e).play();return true}else{return false}}function L(e){if(e){if(!N()){T(e).muted=true}else{T(e).volume(0)}}else{return undefined}}function A(e){if(e){return T(e).pause()}else{return false}}function O(e){if(e){if(!N()){return T(e).paused}else{return T(e).paused()}}else{return false}}function M(e){if(e){if(!N()){return T(e).duration}else{return T(e).duration()}}else{return-1}}function _(e){if(e){if(!N()){return T(e).currentTime}else{return T(e).currentTime()}}else{return-1}}function D(e,t){var n=M(e);if(e&&n!=-1&&!isNaN(t)&&t>=0&&t<=n){if(!N()){T(e).currentTime=t}else{T(e).currentTime(t)}return true}else{D(e,n);return false}}function P(e){if(e){if(!N()){return T(e).buffered}else{return T(e).buffered()}}else{return undefined}}function H(){var n=_(s);var r;for(var i=0;i<t.length;++i){if(t[i]!=s){r=_(t[i]);if(n!=-1&&r!=-1&&!S(r,n-f,n)){e(document).trigger("sjs:synchronizing",[n,t[i]]);if(!D(t[i],n)){}else{k(t[i])}}}}}function B(){if(R()){var n=x(s);n.on("play",function(){e(document).trigger("sjs:masterPlay",[_(s)]);g=false;if(!h&&c){h=true;F()}for(var n=0;n<t.length;++n){if(t[n]!=s){x(t[n]).on("play",function(){L(t[n])});k(t[n])}}});n.on("pause",function(){e(document).trigger("sjs:masterPause",[_(s)]);g=!m&&v;m=m?!m:m;for(var n=0;n<t.length;++n){if(t[n]!=s){A(t[n]);H()}}});n.on("ended",function(){e(document).trigger("sjs:masterEnded",[M(s)]);g=true;for(var n=0;n<t.length;++n){if(t[n]!=s){H();A(t[n])}}});n.on("timeupdate",function(){e(document).trigger("sjs:masterTimeupdate",[_(s)]);g=true;var n=Date.now();if(n-u>a||O(s)){u=n;var r;var i;for(var o=0;o<t.length;++o){if(t[o]!=s){L(t[o]);i=O(t[o]);H();if(i||O(s)){A(t[o])}}}}})}else{for(var r=0;r<t.length;++r){A(t[r])}}}function F(){p=window.setInterval(function(){var n=true;var r=_(s);for(var i=0;i<t.length;++i){var o=P(t[i]);if(o){var u=M(t[i]);var a=_(t[i])+y;var f=false;for(j=0;j<o.length&&!f;++j){a=a>=u?u:a;if(S(a,o.start(j),o.end(j))){f=true}}n=n&&f}else{}}if(!n){v=true;m=true;for(var i=0;i<t.length;++i){A(t[i])}g=false;e(document).trigger("sjs:buffering",[])}else if(v&&!g){v=false;k(s);g=false;e(document).trigger("sjs:bufferedAndAutoplaying",[])}else if(v){v=false;e(document).trigger("sjs:bufferedButNotAutoplaying",[])}},d)}function I(n){i=n<t.length?n:0;s=t[i];e(document).trigger("sjs:masterSet",[s])}function q(e,t){if(e&&t){x(e).on("loadeddata",function(){t()})}}function R(){if(!N()){return o==t.length}else{for(var e=0;e<t.length;++e){if(!r[t[e]]){return false}}return true}}function U(){if(!N()){return o==t.length}else{for(var e=0;e<t.length;++e){if(!n[t[e]]){return false}}return true}}function z(){var e=this;for(var n=0;n<t.length;++n){A(t[n])}l=true}function W(){var e=this;for(var n=0;n<t.length;++n){A(t[n])}l=false}function X(){if(w!=null){window.clearInterval(w);w=null}}var t=[];var n={};var r={};var i=0;var s;var o=0;var u=0;var a=2e3;var f=1;var l=false;var c=true;var h=false;var p;var d=1e3;var v=false;var m=false;var g=false;var y=1.5;var b=true;var w=null;var E=1e4;e.synchronizeVideos=function(u,a,f){var c=true;if(arguments.length==2){var d=e('video[mediagroup="'+a+'"]');for(var v=0;v<d.length;++v){var m=t.length;t[m]=d[v].getAttribute("id");var y="_html5_api";t[m]=N()&&t[m].indexOf(y)!=-1?t[m].substr(0,t[m].length-y.length):t[m];n[t[v-1]]=false;r[t[v-1]]=false}}else{i=u;for(var v=1;v<arguments.length;++v){c=c&&arguments[v]&&e("#"+arguments[v]).length;if(!c){e(document).trigger("sjs:invalidId",[arguments[v]])}else{t[t.length]=arguments[v];n[t[v-1]]=false;r[t[v-1]]=false}}}if(c&&t.length>1){if(!N()){for(var v=0;v<t.length;++v){e(document).trigger("sjs:idRegistered",[t[v]]);var S=u;x(t[v]).on("play",z);x(t[v]).on("pause",W);x(t[v]).ready(function(){++o;if(R()){I(S);for(var n=0;n<t.length;++n){x(t[n]).off("play",z);x(t[n]).off("pause",W)}B();if(l){k(s)}e(document).trigger("sjs:allPlayersReady",[])}})}}else{for(var v=0;v<t.length;++v){e(document).trigger("sjs:idRegistered",[t[v]]);var S=u;x(t[v]).on("play",z);x(t[v]).on("pause",W);x(t[v]).ready(function(){var i=C(this);n[i]=true;q(i,function(){r[i]=true;e(document).trigger("sjs:playerLoaded",[i]);if(R()){I(S);for(var n=0;n<t.length;++n){x(t[n]).off("play",z);x(t[n]).off("pause",W)}B();if(l){k(s)}e(document).trigger("sjs:allPlayersReady",[])}})})}}}else{e(document).trigger("sjs:notEnoughVideos",[])}if(b){e(document).on("sjs:buffering",function(e){w=setInterval(function(){if(R()&&!g){k(s)}},E)});e(document).on("sjs:bufferedAndAutoplaying",function(e){X()});e(document).on("sjs:bufferedButNotAutoplaying",function(e){X()})}e(document).on("sjs:play",function(e){if(R()){k(s)}});e(document).on("sjs:pause",function(e){if(R()){A(s)}});e(document).on("sjs:setCurrentTime",function(e,t){if(R()){D(s,t)}});e(document).on("sjs:synchronize",function(e){if(R()){H()}});e(document).on("sjs:startBufferChecker",function(e){if(!h){window.clearInterval(p);h=true;F()}});e(document).on("sjs:stopBufferChecker",function(e){window.clearInterval(p);h=false})}})(jQuery)