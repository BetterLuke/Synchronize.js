/**
 * Synchronize.js
 * Version 1.1.2
 *
 * Copyright 2013-2014 Denis Meyer
 */
(function(e){function N(e,t,n){if(!isNaN(e)&&!isNaN(t)&&!isNaN(n)&&t<=n){return e>=t&&e<=n}else{return false}}function C(t){if(t){if(!L()){return e("#"+t)}else{return videojs(t)}}else{return undefined}}function k(e){if(e){if(!L()){return C(e).get(0)}else{return videojs(e)}}else{return undefined}}function L(){return!(typeof videojs==="undefined")}function A(e){if(L()&&e){return e.Q}else{return e}}function O(e){if(e){k(e).play();return true}else{return false}}function M(e){if(e){if(!L()){k(e).muted=true}else{k(e).volume(0)}}else{return undefined}}function _(e){if(e){return k(e).pause()}else{return false}}function D(e){if(e){if(!L()){return k(e).paused}else{return k(e).paused()}}else{return false}}function P(e){if(e){if(!L()){return k(e).duration}else{return k(e).duration()}}else{return-1}}function H(e){if(e){if(!L()){return k(e).currentTime}else{return k(e).currentTime()}}else{return-1}}function B(e,t){var n=P(e);if(e&&n!=-1&&!isNaN(t)&&t>=0&&t<=n){if(!L()){k(e).currentTime=t}else{k(e).currentTime(t)}return true}else{B(e,n);return false}}function F(e){if(e){if(!L()){return k(e).buffered}else{return k(e).buffered()}}else{return undefined}}function I(){var n=H(s);var r;for(var i=0;i<t.length;++i){if(t[i]!=s){r=H(t[i]);if(n!=-1&&r!=-1&&!N(r,n-f,n)){e(document).trigger("sjs:synchronizing",[n,t[i]]);if(!B(t[i],n)){}else{O(t[i])}}}}}function q(){if(W()){var n=C(s);n.on("play",function(){e(document).trigger("sjs:masterPlay",[H(s)]);g=false;if(!h&&c){h=true;R()}for(var n=0;n<t.length;++n){if(t[n]!=s){C(t[n]).on("play",function(){M(t[n])});O(t[n])}}});n.on("pause",function(){e(document).trigger("sjs:masterPause",[H(s)]);g=!m&&v;m=m?!m:m;for(var n=0;n<t.length;++n){if(t[n]!=s){_(t[n]);I()}}});n.on("ended",function(){e(document).trigger("sjs:masterEnded",[P(s)]);g=true;for(var n=0;n<t.length;++n){if(t[n]!=s){I();_(t[n])}}});n.on("timeupdate",function(){e(document).trigger("sjs:masterTimeupdate",[H(s)]);g=true;var n=Date.now();if(n-u>a||D(s)){u=n;var r;var i;for(var o=0;o<t.length;++o){if(t[o]!=s){M(t[o]);i=D(t[o]);I();if(i||D(s)){_(t[o])}}}}})}else{for(var r=0;r<t.length;++r){_(t[r])}}}function R(){p=window.setInterval(function(){var n=true;var r=H(s);for(var i=0;i<t.length;++i){var o=F(t[i]);if(o){var u=P(t[i]);var a=H(t[i])+y;var f=false;for(j=0;j<o.length&&!f;++j){a=a>=u?u:a;if(N(a,o.start(j),o.end(j))){f=true}}n=n&&f}else{}}if(!n){v=true;m=true;for(var i=0;i<t.length;++i){_(t[i])}g=false;e(document).trigger("sjs:buffering",[])}else if(v&&!g){v=false;O(s);g=false;e(document).trigger("sjs:bufferedAndAutoplaying",[])}else if(v){v=false;e(document).trigger("sjs:bufferedButNotAutoplaying",[])}},d)}function U(n){i=n<t.length?n:0;s=t[i];e(document).trigger("sjs:masterSet",[s])}function z(e,t){if(e&&t){C(e).on("loadeddata",function(){S=true;t()})}}function W(){if(!L()){return o==t.length}else{for(var e=0;e<t.length;++e){if(!r[t[e]]){return false}}return true}}function X(){if(!L()){return o==t.length}else{for(var e=0;e<t.length;++e){if(!n[t[e]]){return false}}return true}}function V(){var e=this;for(var n=0;n<t.length;++n){_(t[n])}l=true}function $(){var e=this;for(var n=0;n<t.length;++n){_(t[n])}l=false}function J(){if(w!=null){window.clearInterval(w);w=null}}var t=[];var n={};var r={};var i=0;var s;var o=0;var u=0;var a=2e3;var f=1;var l=false;var c=true;var h=false;var p;var d=1e3;var v=false;var m=false;var g=false;var y=1.5;var b=true;var w=null;var E=1e4;var S=false;var x=null;var T=5e3;e.synchronizeVideos=function(u,a,f){var c=true;if(arguments.length==2){var d=e('video[mediagroup="'+a+'"]');for(var v=0;v<d.length;++v){var m=t.length;t[m]=d[v].getAttribute("id");var y="_html5_api";t[m]=L()&&t[m].indexOf(y)!=-1?t[m].substr(0,t[m].length-y.length):t[m];n[t[v-1]]=false;r[t[v-1]]=false}}else{i=u;for(var v=1;v<arguments.length;++v){c=c&&arguments[v]&&e("#"+arguments[v]).length;if(!c){e(document).trigger("sjs:invalidId",[arguments[v]])}else{t[t.length]=arguments[v];n[t[v-1]]=false;r[t[v-1]]=false}}}if(c&&t.length>1){if(!L()){for(var v=0;v<t.length;++v){e(document).trigger("sjs:idRegistered",[t[v]]);var N=u;C(t[v]).on("play",V);C(t[v]).on("pause",$);C(t[v]).ready(function(){++o;if(W()){U(N);for(var n=0;n<t.length;++n){C(t[n]).off("play",V);C(t[n]).off("pause",$)}q();if(l){O(s)}e(document).trigger("sjs:allPlayersReady",[])}})}}else{for(var v=0;v<t.length;++v){e(document).trigger("sjs:idRegistered",[t[v]]);var N=u;C(t[v]).on("play",V);C(t[v]).on("pause",$);C(t[v]).ready(function(){var i=A(this);n[i]=true;z(i,function(){r[i]=true;e(document).trigger("sjs:playerLoaded",[i]);if(W()){U(N);for(var n=0;n<t.length;++n){C(t[n]).off("play",V);C(t[n]).off("pause",$)}q();if(l){O(s)}e(document).trigger("sjs:allPlayersReady",[])}})})}}x=window.setInterval(function(){if(!S){for(var e=0;e<t.length;++e){C(t[e]).trigger("loadeddata")}}else{window.clearInterval(x);x=null}},T)}else{e(document).trigger("sjs:notEnoughVideos",[])}if(b){e(document).on("sjs:buffering",function(e){w=setInterval(function(){if(W()&&!g){O(s)}},E)});e(document).on("sjs:bufferedAndAutoplaying",function(e){J()});e(document).on("sjs:bufferedButNotAutoplaying",function(e){J()})}e(document).on("sjs:play",function(e){if(W()){O(s)}});e(document).on("sjs:pause",function(e){if(W()){_(s)}});e(document).on("sjs:setCurrentTime",function(e,t){if(W()){B(s,t)}});e(document).on("sjs:synchronize",function(e){if(W()){I()}});e(document).on("sjs:startBufferChecker",function(e){if(!h){window.clearInterval(p);h=true;R()}});e(document).on("sjs:stopBufferChecker",function(e){window.clearInterval(p);h=false})}})(jQuery)