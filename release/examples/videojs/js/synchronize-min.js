/**
 * Synchronize.js
 * Version 1.1.0
 *
 * Copyright 2013 Denis Meyer
 */
!function(n){function e(n,e,t){return!isNaN(n)&&!isNaN(e)&&!isNaN(t)&&t>=e?n>=e&&t>=n:!1}function t(e){return e?o()?videojs(e):n("#"+e):void 0}function r(n){return n?o()?videojs(n):t(n).get(0):void 0}function o(){return!("undefined"==typeof videojs)}function u(n){return o()&&n?n.Q:n}function i(n){return n?(r(n).play(),!0):!1}function s(n){return n?(o()?r(n).volume(0):r(n).muted=!0,void 0):void 0}function a(n){return n?r(n).pause():!1}function f(n){return n?o()?r(n).paused():r(n).paused:!1}function g(n){return n?o()?r(n).duration():r(n).duration:-1}function d(n){return n?o()?r(n).currentTime():r(n).currentTime:-1}function c(n,e){var t=g(n);return n&&-1!=t&&!isNaN(e)&&e>=0&&t>=e?(o()?r(n).currentTime(e):r(n).currentTime=e,!0):(c(n,t),!1)}function l(n){return n?o()?r(n).buffered():r(n).buffered:void 0}function m(){for(var t,r=d(T),o=0;o<I.length;++o)I[o]!=T&&(t=d(I[o]),-1==r||-1==t||e(t,r-E,r)||(n(document).trigger("sjs:synchronizing",[r,I[o]]),c(I[o],r)&&i(I[o])))}function v(){if(N()){var e=t(T);e.on("play",function(){n(document).trigger("sjs:masterPlay",[d(T)]),L=!1,V||(V=!0,h());for(var e=0;e<I.length;++e)I[e]!=T&&(t(I[e]).on("play",function(){s(I[e])}),i(I[e]))}),e.on("pause",function(){n(document).trigger("sjs:masterPause",[d(T)]),L=!D&&x&&!0,D=D?!D:D;for(var e=0;e<I.length;++e)I[e]!=T&&(a(I[e]),m())}),e.on("ended",function(){n(document).trigger("sjs:masterEnded",[g(T)]),L=!0;for(var e=0;e<I.length;++e)I[e]!=T&&(m(),a(I[e]))}),e.on("timeupdate",function(){n(document).trigger("sjs:masterTimeupdate",[d(T)]),L=!0;var e=Date.now();if(e-C>k||f(T)){C=e;for(var t,r=0;r<I.length;++r)I[r]!=T&&(s(I[r]),t=f(I[r]),m(),(t||f(T))&&a(I[r]))}})}else for(var r=0;r<I.length;++r)a(I[r])}function h(){A=window.setInterval(function(){for(var t=!0,r=(d(T),0);r<I.length;++r){var o=l(I[r]);if(o){var u=g(I[r]),s=d(I[r])+O,f=!1;for(j=0;j<o.length&&!f;++j)s=s>=u?u:s,e(s,o.start(j),o.end(j))&&(f=!0);t=t&&f}}if(t)x&&!L?(x=!1,i(T),L=!1,n(document).trigger("sjs:bufferedAndAutoplaying",[])):x&&(x=!1,n(document).trigger("sjs:bufferedButNotAutoplaying",[]));else{x=!0,D=!0;for(var r=0;r<I.length;++r)a(I[r]);L=!1,n(document).trigger("sjs:buffering",[])}},_)}function p(e){z=e<I.length?e:0,T=I[z],n(document).trigger("sjs:masterSet",[T])}function y(n,e){n&&e&&t(n).on("loadeddata",function(){e()})}function N(){if(o()){for(var n=0;n<I.length;++n)if(!R[I[n]])return!1;return!0}return B==I.length}function b(){for(var n=0;n<I.length;++n)a(I[n]);Q=!0}function w(){for(var n=0;n<I.length;++n)a(I[n]);Q=!1}var T,A,I=[],P={},R={},z=0,B=0,C=0,k=2e3,E=1,Q=!1,V=!1,_=1e3,x=!1,D=!1,L=!1,O=1.5;n.synchronizeVideos=function(e,r){var s=!0;if(2==arguments.length)for(var f=n('video[mediagroup="'+r+'"]'),g=0;g<f.length;++g){var d=I.length;I[d]=f[g].getAttribute("id");var l="_html5_api";I[d]=o()&&-1!=I[d].indexOf(l)?I[d].substr(0,I[d].length-l.length):I[d],P[I[g-1]]=!1,R[I[g-1]]=!1}else{z=e;for(var g=1;g<arguments.length;++g)s=s&&arguments[g]&&n("#"+arguments[g]).length,s?(I[I.length]=arguments[g],P[I[g-1]]=!1,R[I[g-1]]=!1):n(document).trigger("sjs:invalidId",[arguments[g]])}if(s&&I.length>1)if(o())for(var g=0;g<I.length;++g){n(document).trigger("sjs:idRegistered",[I[g]]);var j=e;t(I[g]).on("play",b),t(I[g]).on("pause",w),t(I[g]).ready(function(){var e=u(this);P[e]=!0,y(e,function(){if(R[e]=!0,n(document).trigger("sjs:playerLoaded",[e]),N()){p(j);for(var r=0;r<I.length;++r)t(I[r]).off("play",b),t(I[r]).off("pause",w);v(),Q&&i(T),n(document).trigger("sjs:allPlayersReady",[])}})})}else for(var g=0;g<I.length;++g){n(document).trigger("sjs:idRegistered",[I[g]]);var j=e;t(I[g]).on("play",b),t(I[g]).on("pause",w),t(I[g]).ready(function(){if(++B,N()){p(j);for(var e=0;e<I.length;++e)t(I[e]).off("play",b),t(I[e]).off("pause",w);v(),Q&&i(T),n(document).trigger("sjs:allPlayersReady",[])}})}else n(document).trigger("sjs:notEnoughVideos",[]);n(document).on("sjs:play",function(){N()&&i(T)}),n(document).on("sjs:pause",function(){N()&&a(T)}),n(document).on("sjs:setCurrentTime",function(n,e){N()&&c(T,e)}),n(document).on("sjs:synchronize",function(){N()&&m()}),n(document).on("sjs:startBufferChecker",function(){V||(window.clearInterval(A),V=!0,h())}),n(document).on("sjs:stopBufferChecker",function(){window.clearInterval(A),V=!1})}}(jQuery);